# OpenRecommend æ¨¡å—å®ç°æ€»ç»“

## ğŸ“Š å·²å®Œæˆæ¨¡å—æ¸…å•

### 1. é¡¹ç›®åŸºç¡€é…ç½® âœ…

| æ¨¡å— | çŠ¶æ€ | è¯´æ˜ |
|-----|------|------|
| çˆ¶POMé…ç½® | âœ… å®Œæˆ | ä¾èµ–ç®¡ç†ã€æ’ä»¶é…ç½® |
| å­æ¨¡å—POM | âœ… å®Œæˆ | common/api/service/webå››ä¸ªæ¨¡å— |
| åº”ç”¨é…ç½® | âœ… å®Œæˆ | application.yml |
| å¯åŠ¨ç±» | âœ… å®Œæˆ | OpenRecommendApplication |

### 2. å…¬å…±æ¨¡å— (openrecommend-common) âœ…

| åŒ…/ç±» | çŠ¶æ€ | åŠŸèƒ½ |
|-------|------|------|
| enums.ContentType | âœ… å®Œæˆ | å†…å®¹ç±»å‹æšä¸¾ |
| enums.BehaviorType | âœ… å®Œæˆ | è¡Œä¸ºç±»å‹æšä¸¾ |
| constants.RecommendConstants | âœ… å®Œæˆ | æ¨èå¸¸é‡å®šä¹‰ |
| exception.BusinessException | âœ… å®Œæˆ | ä¸šåŠ¡å¼‚å¸¸ç±» |
| result.Result | âœ… å®Œæˆ | ç»Ÿä¸€å“åº”ç»“æœ |

### 3. APIæ¨¡å— (openrecommend-api) âœ…

| åŒ…/ç±» | çŠ¶æ€ | åŠŸèƒ½ |
|-------|------|------|
| dto.RecommendRequest | âœ… å®Œæˆ | æ¨èè¯·æ±‚DTO |
| dto.RecommendResponse | âœ… å®Œæˆ | æ¨èå“åº”DTO |
| dto.RecommendItem | âœ… å®Œæˆ | æ¨èé¡¹DTO |
| controller.RecommendController | âœ… å®Œæˆ | æ¨èAPIæ§åˆ¶å™¨ |

### 4. æœåŠ¡æ¨¡å— (openrecommend-service) â³

| åŒ…/ç±» | çŠ¶æ€ | åŠŸèƒ½ |
|-------|------|------|
| entity.BaseDO | âœ… å®Œæˆ | åŸºç¡€å®ä½“ç±» |
| entity.Article | âœ… å®Œæˆ | æ–‡ç« å®ä½“ |
| entity.Image | âœ… å®Œæˆ | å›¾ç‰‡å®ä½“ |
| entity.Video | âœ… å®Œæˆ | è§†é¢‘å®ä½“ |
| entity.User | âœ… å®Œæˆ | ç”¨æˆ·å®ä½“ |
| entity.UserProfile | âœ… å®Œæˆ | ç”¨æˆ·ç”»åƒå®ä½“ |
| entity.UserBehavior | âœ… å®Œæˆ | ç”¨æˆ·è¡Œä¸ºå®ä½“ |
| service.RecommendService | âœ… å®Œæˆ | æ¨èæœåŠ¡æ¥å£ |
| service.impl.RecommendServiceImpl | â³ æ¡†æ¶å®Œæˆ | æ¨èæœåŠ¡å®ç°ï¼ˆéœ€è¦å®Œå–„ç®—æ³•ï¼‰ |
| mapper.* | â³ å¾…å®ç° | Mapperæ¥å£ |

### 5. Webæ¨¡å— (openrecommend-web) âœ…

| åŒ…/ç±» | çŠ¶æ€ | åŠŸèƒ½ |
|-------|------|------|
| OpenRecommendApplication | âœ… å®Œæˆ | åº”ç”¨å¯åŠ¨ç±» |
| config.MyBatisPlusConfig | âœ… å®Œæˆ | MyBatis-Plusé…ç½® |
| config.RedisConfig | âœ… å®Œæˆ | Redisé…ç½® |
| config.ThreadPoolConfig | âœ… å®Œæˆ | çº¿ç¨‹æ± é…ç½®ï¼ˆè™šæ‹Ÿçº¿ç¨‹ï¼‰ |
| exception.GlobalExceptionHandler | âœ… å®Œæˆ | å…¨å±€å¼‚å¸¸å¤„ç† |

---

## ğŸš§ éœ€è¦å®Œå–„çš„æ ¸å¿ƒåŠŸèƒ½

### 1. æ•°æ®è®¿é—®å±‚ (Mapper)

éœ€è¦åˆ›å»ºä»¥ä¸‹Mapperæ¥å£ï¼š

```java
// ArticleMapper.java
@Mapper
public interface ArticleMapper extends BaseMapper<Article> {
    // æ ¹æ®æ ‡ç­¾æŸ¥è¯¢æ–‡ç« 
    List<Article> selectByTags(Set<String> tags, int limit);
    // æŸ¥è¯¢çƒ­é—¨æ–‡ç« 
    List<Article> selectHotArticles(int days, int limit);
    // æŸ¥è¯¢æœªé˜…è¯»çš„æ–‡ç« 
    List<Article> selectNotInIds(List<Long> excludeIds);
}

// ImageMapper.java
@Mapper
public interface ImageMapper extends BaseMapper<Image> {
    // æŸ¥è¯¢çƒ­é—¨å›¾ç‰‡
    List<Image> selectHotImages(int days, int limit);
}

// VideoMapper.java
@Mapper
public interface VideoMapper extends BaseMapper<Video> {
    // æŸ¥è¯¢çƒ­é—¨è§†é¢‘
    List<Video> selectHotVideos(int days, int limit);
}

// UserBehaviorMapper.java
@Mapper
public interface UserBehaviorMapper extends BaseMapper<UserBehavior> {
    // æŸ¥è¯¢ç”¨æˆ·è¿‘æœŸè¡Œä¸º
    List<UserBehavior> selectRecentBehaviors(Long userId, int days);
    // æŸ¥è¯¢ç”¨æˆ·å†å²å†…å®¹ID
    List<Long> selectHistoryContentIds(Long userId, String contentType);
}

// UserProfileMapper.java
@Mapper
public interface UserProfileMapper extends BaseMapper<UserProfile> {
    // æ ¹æ®ç”¨æˆ·IDæŸ¥è¯¢ç”»åƒ
    UserProfile selectByUserId(Long userId);
}

// UserMapper.java
@Mapper
public interface UserMapper extends BaseMapper<User> {
    // åŸºç¡€CRUDç»§æ‰¿è‡ªBaseMapper
}
```

### 2. æ¨èç®—æ³•å®ç°

éœ€è¦å®Œå–„ä»¥ä¸‹ç®—æ³•ç±»ï¼š

```java
// åŸºäºå†…å®¹çš„æ¨èç®—æ³•
- ContentBasedRecommender.java
  - recommendByTags() - åŸºäºæ ‡ç­¾æ¨è
  - recommendBySimilarity() - åŸºäºç›¸ä¼¼åº¦æ¨è

// ååŒè¿‡æ»¤ç®—æ³•
- CollaborativeFiltering.java
  - userBasedCF() - åŸºäºç”¨æˆ·çš„ååŒè¿‡æ»¤
  - itemBasedCF() - åŸºäºç‰©å“çš„ååŒè¿‡æ»¤

// ç›¸ä¼¼åº¦è®¡ç®—
- SimilarityCalculator.java
  - cosineSimilarity() - ä½™å¼¦ç›¸ä¼¼åº¦
  - jaccardSimilarity() - Jaccardç›¸ä¼¼åº¦

// ç‰¹å¾æå–
- FeatureExtractor.java
  - extractTextFeatures() - æå–æ–‡æœ¬ç‰¹å¾
  - extractVisualFeatures() - æå–è§†è§‰ç‰¹å¾

// æ’åºæœåŠ¡
- RankingService.java
  - rank() - æ’åºæ‰“åˆ†
  - diversify() - å¤šæ ·æ€§å¤„ç†
```

### 3. ä¸šåŠ¡æœåŠ¡å®ç°

éœ€è¦å®Œå–„ä»¥ä¸‹æœåŠ¡ï¼š

```java
// ç”¨æˆ·ç”»åƒæœåŠ¡
- UserProfileService
  - getById() - è·å–ç”¨æˆ·ç”»åƒ
  - updateAsync() - å¼‚æ­¥æ›´æ–°ç”¨æˆ·ç”»åƒ
  - calculateProfile() - è®¡ç®—ç”¨æˆ·ç”»åƒ

// å†…å®¹æœåŠ¡
- ArticleService
  - publish() - å‘å¸ƒæ–‡ç« 
  - getDetail() - è·å–æ–‡ç« è¯¦æƒ…
  - list() - æ–‡ç« åˆ—è¡¨

- ImageService
  - upload() - ä¸Šä¼ å›¾ç‰‡
  - getDetail() - è·å–å›¾ç‰‡è¯¦æƒ…

- VideoService
  - upload() - ä¸Šä¼ è§†é¢‘
  - getDetail() - è·å–è§†é¢‘è¯¦æƒ…

// ç”¨æˆ·è¡Œä¸ºæœåŠ¡
- UserBehaviorService
  - recordBehavior() - è®°å½•ç”¨æˆ·è¡Œä¸º
  - getHistory() - è·å–è¡Œä¸ºå†å²

// ç¼“å­˜æœåŠ¡
- CacheService
  - getUserProfile() - è·å–ç”¨æˆ·ç”»åƒç¼“å­˜
  - setRecommend() - è®¾ç½®æ¨èç»“æœç¼“å­˜
  - getRecommend() - è·å–æ¨èç»“æœç¼“å­˜
```

### 4. æ§åˆ¶å™¨å®Œå–„

éœ€è¦æ·»åŠ ä»¥ä¸‹æ§åˆ¶å™¨ï¼š

```java
// å†…å®¹æ§åˆ¶å™¨
- ContentController
  - POST /api/content/article - å‘å¸ƒæ–‡ç« 
  - GET /api/content/article/{id} - è·å–æ–‡ç« è¯¦æƒ…
  - POST /api/content/image - ä¸Šä¼ å›¾ç‰‡
  - POST /api/content/video - ä¸Šä¼ è§†é¢‘

// ç”¨æˆ·æ§åˆ¶å™¨
- UserController
  - POST /api/user/register - ç”¨æˆ·æ³¨å†Œ
  - POST /api/user/login - ç”¨æˆ·ç™»å½•
  - GET /api/user/info/{userId} - è·å–ç”¨æˆ·ä¿¡æ¯
  - GET /api/user/profile/{userId} - è·å–ç”¨æˆ·ç”»åƒ

// ç”¨æˆ·è¡Œä¸ºæ§åˆ¶å™¨
- BehaviorController
  - POST /api/behavior/record - è®°å½•ç”¨æˆ·è¡Œä¸º
  - GET /api/behavior/history/{userId} - è·å–è¡Œä¸ºå†å²
```

---

## ğŸ“‹ å®Œæˆä¼˜å…ˆçº§

### P0 - æ ¸å¿ƒåŠŸèƒ½ âœ…

1. âœ… åŸºç¡€å®ä½“ç±»
2. âœ… åŸºç¡€é…ç½®ç±»
3. âœ… Mapperæ¥å£ï¼ˆ6ä¸ªï¼‰
4. âœ… æ¨èæœåŠ¡æ ¸å¿ƒç®—æ³•å®ç°
5. âœ… ç”¨æˆ·ç”»åƒæœåŠ¡
6. âœ… ç¼“å­˜æœåŠ¡
7. âœ… æ¨èç®—æ³•ï¼ˆåŸºäºå†…å®¹ã€ååŒè¿‡æ»¤ï¼‰
8. âœ… ç›¸ä¼¼åº¦è®¡ç®—æœåŠ¡

### P1 - é‡è¦åŠŸèƒ½ï¼ˆå»ºè®®å®Œæˆï¼‰

1. â³ å†…å®¹æœåŠ¡ï¼ˆæ–‡ç« ã€å›¾ç‰‡ã€è§†é¢‘ï¼‰
2. â³ ç”¨æˆ·è¡Œä¸ºæœåŠ¡
3. â³ æ§åˆ¶å™¨ï¼ˆContentControllerã€UserControllerã€BehaviorControllerï¼‰
4. â³ æ’åºæœåŠ¡
5. â³ å¤šæ ·æ€§å¤„ç†ç®—æ³•

### P2 - å¢å¼ºåŠŸèƒ½ï¼ˆå¯é€‰å®Œæˆï¼‰

1. â³ æ–‡æœ¬ç‰¹å¾æå–ï¼ˆTF-IDFï¼‰
2. â³ è§†è§‰ç‰¹å¾æå–ï¼ˆé¢œè‰²ç›´æ–¹å›¾ï¼‰
3. â³ çƒ­é—¨å†…å®¹å®šæ—¶è®¡ç®—ä»»åŠ¡
4. â³ A/Bæµ‹è¯•æ”¯æŒ
5. â³ å®æ—¶æ¨èæµå¤„ç†

---

## ğŸ”§ æŠ€æœ¯è¦ç‚¹

### 1. è™šæ‹Ÿçº¿ç¨‹ä½¿ç”¨

```java
@Bean("virtualThreadExecutor")
public ExecutorService virtualThreadExecutor() {
    return Executors.newVirtualThreadPerTaskExecutor();
}

// åœ¨æ¨èæœåŠ¡ä¸­ä½¿ç”¨
@Async("virtualThreadExecutor")
public CompletableFuture<List<RecommendItem>> recommendAsync(Long userId) {
    // å¼‚æ­¥æ‰§è¡Œæ¨è
}
```

### 2. ç¼“å­˜ç­–ç•¥

```java
// Cache-Asideæ¨¡å¼
public UserProfile getUserProfile(Long userId) {
    String key = "user_profile:" + userId;
    UserProfile profile = redisTemplate.opsForValue().get(key);
    if (profile == null) {
        profile = userMapper.selectById(userId);
        if (profile != null) {
            redisTemplate.opsForValue().set(key, profile, 1, TimeUnit.HOURS);
        }
    }
    return profile;
}
```

### 3. å¹¶å‘æ¨è

```java
public RecommendResponse recommend(Long userId) {
    List<CompletableFuture<List<RecommendItem>>> futures = List.of(
        CompletableFuture.supplyAsync(() -> recommendByContent(userId), virtualThreadExecutor),
        CompletableFuture.supplyAsync(() -> recommendByCF(userId), virtualThreadExecutor),
        CompletableFuture.supplyAsync(() -> recommendHot(userId), virtualThreadExecutor)
    );

    CompletableFuture.allOf(futures.toArray(new CompletableFuture[0])).join();

    // åˆå¹¶ç»“æœ
    List<RecommendItem> result = futures.stream()
        .flatMap(future -> future.join().stream())
        .collect(Collectors.toList());

    return mergeAndRank(result);
}
```

---

## ğŸ“š å‚è€ƒèµ„æ–™

- Spring Boot 3.5.10 å®˜æ–¹æ–‡æ¡£
- MyBatis-Plus 3.5.7 å®˜æ–¹æ–‡æ¡£
- JDK 21 è™šæ‹Ÿçº¿ç¨‹ç‰¹æ€§
- Redis ç¼“å­˜æœ€ä½³å®è·µ
- æ¨èç³»ç»Ÿç®—æ³•å®ç°æŒ‡å—

---

## ğŸ“ å¼€å‘å»ºè®®

1. **åˆ†æ­¥å®ç°**ï¼šå…ˆå®ŒæˆP0æ ¸å¿ƒåŠŸèƒ½ï¼Œå†é€æ­¥å®ç°P1å’ŒP2
2. **æµ‹è¯•é©±åŠ¨**ï¼šæ¯ä¸ªåŠŸèƒ½å®Œæˆåç¼–å†™å•å…ƒæµ‹è¯•
3. **æ€§èƒ½ä¼˜åŒ–**ï¼šä½¿ç”¨è™šæ‹Ÿçº¿ç¨‹å’Œå¤šçº§ç¼“å­˜æå‡æ€§èƒ½
4. **ä»£ç è§„èŒƒ**ï¼šéµå¾ªé˜¿é‡Œå·´å·´Javaå¼€å‘è§„èŒƒ
5. **æ–‡æ¡£ç»´æŠ¤**ï¼šåŠæ—¶æ›´æ–°APIæ–‡æ¡£å’ŒæŠ€æœ¯æ–‡æ¡£

---

Â© 2026 Qoobot. All rights reserved.
